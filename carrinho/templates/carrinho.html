{% load static %}
<html lang="pt-br">
  <head>
    <!-- Meta tags Obrigatórias -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS e Font Awesome (para ícones) -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" xintegrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" xintegrity="sha512-1ycn6IcaQQ40B79L/P/tM1jW7JzWl8YxKx+I/lP8x0n4uNqP+8Lh/2/2lT/1t3aG9U6B6S6S" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'principal/style.css' %}">

    <title>Meu Carrinho - Pizzaria Bem Recheada</title>

    <style>
        /* Estilos complementares que não estão no style.css, mas garantem o visual dark */
        .card-gta {
            background-color: #1a1a1a; /* Fundo do card mais escuro que o body */
            color: #f5f5f5;
            border: 3px solid #ffcc00; /* Borda amarela de destaque (GTA Yellow) */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.4); /* Brilho amarelo */
        }
        .item-row {
            padding: 15px 0;
            border-bottom: 1px dashed #333; /* Linha tracejada escura */
            align-items: center;
        }
        .item-row:last-child {
            border-bottom: none;
        }
        .btn-quantity {
            width: 30px;
            height: 30px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
        }
        .quantity-display {
            padding: 0 10px;
            font-weight: bold;
            color: #ffcc00; /* Número da quantidade em amarelo */
            min-width: 40px;
            text-align: center;
        }
        /* Sticky para o resumo, com pequena margem */
        .summary-sticky {
            position: sticky;
            top: 20px;
        }
    </style>
  </head>
  <body>

    <!-- Seu H1 e Menu (Mantendo a estrutura do seu home.html) -->
    <h1>Pizzaria Bem Recheada</h1>
    {% include 'menu.html' %}

    <div class="container mt-5 mb-5">
        <div class="row">

            <!-- Coluna Principal do Carrinho -->
            <div class="col-lg-8">
                <!-- Usando H2 para o título do carrinho -->
                <h2>
                    <i class="fas fa-shopping-cart"></i> Seu Carrinho de Compras
                </h2>

                {% if carrinho_itens %}

                    <!-- Lista de Itens do Carrinho -->
                    <div class="card card-gta p-4 shadow-lg mb-4">
                        <h4 class="card-title text-warning mb-4">Itens Atuais do Pedido</h4>

                        {% for item in carrinho_itens %}
                        <!-- Item do carrinho -->
                        <div class="d-flex item-row">

                            <!-- Imagem e Nome do Produto -->
                            <div class="d-flex align-items-center flex-grow-1">
                                <!-- Usando um placeholder estático -->
                                <img src="{% static 'principal/pizza_placeholder.png' %}" alt="{{ item.produto.nome }}" class="mr-3 rounded" style="width: 70px; height: 70px; object-fit: cover; border: 3px solid #d62828;">
                                <div>
                                    <h5 class="mb-0 text-white">{{ item.produto.nome }}</h5>
                                    <small class="text-secondary">Preço Un.: R$ <strong class="text-warning">{{ item.produto.valor|floatformat:2 }}</strong></small>
                                </div>
                            </div>

                            <!-- Controles de Quantidade -->
                            <div class="d-flex align-items-center ml-auto mr-4">
                                <!-- Botão de Subtrair (Estilo Danger/Vermelho Escuro) -->
                                <button class="btn btn-sm btn-outline-danger btn-quantity" disabled>
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="quantity-display text-warning">{{ item.quantidade }}</span>
                                <!-- Botão de Adicionar (Estilo Success/Laranja, ou Warning/Amarelo) -->
                                <a href="{% url 'addcarrinho' item.produto.id %}" class="btn btn-sm btn-outline-warning btn-quantity">
                                    <i class="fas fa-plus"></i>
                                </a>
                            </div>

                            <!-- Subtotal -->
                            <div class="text-right d-flex align-items-center">
                                <span class="text-light font-weight-bold mr-3">Subtotal: <strong class="text-warning">R$ {{ item.item_total|floatformat:2 }}</strong></span>
                                <!-- Ícone de lixeira (Remoção desativada por enquanto) -->
                                <button class="btn btn-sm btn-outline-danger btn-quantity" disabled>
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>

                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <!-- Carrinho Vazio -->
                    <div class="alert alert-warning text-center card-gta border-0" role="alert" style="box-shadow: none;">
                        <h4 class="alert-heading text-warning"><i class="fas fa-box-open mr-2"></i> Carrinho Vazio!</h4>
                        <p class="mb-0 text-light">Nenhuma explosão de sabor por aqui ainda. Adicione alguns itens para iniciar seu pedido.</p>
                    </div>
                    <a href="{% url 'home' %}" class="btn btn-outline-warning btn-lg btn-block mt-4">
                        <i class="fas fa-pizza-slice mr-2"></i> Ver Cardápio
                    </a>
                {% endif %}
            </div>

            <!-- Coluna de Resumo -->
            <div class="col-lg-4">
                <!-- Usando o mesmo estilo de card e cores da paleta -->
                <div class="card card-gta p-4 summary-sticky shadow-lg">
                    <h4 class="text-danger mb-4"><i class="fas fa-receipt"></i> Resumo da Transação</h4>

                    {% if carrinho_itens %}

                        <!-- Subtotal (Valor Bruto) -->
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-light">Subtotal (Itens):</span>
                            <span class="font-weight-bold text-warning">R$ {{ total|floatformat:2 }}</span>
                        </div>

                        <!-- Frete (Placeholder) -->
                        <div class="d-flex justify-content-between mb-4">
                            <span class="text-light">Taxa de Entrega:</span>
                            <span class="font-weight-bold text-warning">R$ 0,00</span>
                        </div>

                        <hr class="my-3 border-secondary">

                        <!-- Total Final (Destaque Vermelho) -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="text-warning mb-0">TOTAL GERAL:</h5>
                            <h5 class="text-danger mb-0">R$ {{ total|floatformat:2 }}</h5>
                        </div>

                        <!-- Botão Checkout (Vermelho de Destaque) -->
                        <button class="btn btn-danger btn-lg btn-block mb-2" onclick="alert('Funcionalidade de Checkout ainda não implementada, volte logo!')">
                            <i class="fas fa-dollar-sign mr-2"></i> FECHAR CONTA
                        </button>
                        <!-- Botão Continuar Comprando (Amarelo de Contraste) -->
                        <a href="{% url 'home' %}" class="btn btn-outline-warning btn-block">
                            <i class="fas fa-angle-left mr-2"></i> Voltar ao Cardápio
                        </a>

                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" xintegrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" xintegrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" xintegrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        // Função de alerta customizada
        function alert(message) {
            console.log("ALERTA:", message);
            // Implementação de modal customizada seria ideal aqui
            var modal = document.createElement('div');
            modal.innerHTML = '<div class="modal fade" id="customAlert" tabindex="-1" role="dialog" aria-labelledby="customAlertLabel" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content bg-dark text-white"><div class="modal-header border-warning"><h5 class="modal-title text-warning" id="customAlertLabel">Atenção!</h5><button type="button" class="close text-white" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">' + message + '</div><div class="modal-footer border-warning"><button type="button" class="btn btn-warning" data-dismiss="modal">OK</button></div></div></div></div>';
            document.body.appendChild(modal);
            $('#customAlert').modal('show');
            $('#customAlert').on('hidden.bs.modal', function (e) {
                modal.remove();
            });
        }
    </script>
  </body>
</html>
